<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLG-Financials - Admin & Customer Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .panel {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .panel.active {
            display: block;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        input, select, button {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            background: #667eea;
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
            margin-top: 10px;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 500px;
        }
        
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .message {
            margin-bottom: 15px;
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            background: #667eea;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .message.bot {
            background: white;
            color: #333;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .input-group input {
            flex: 1;
        }
        
        .input-group button {
            width: auto;
            padding: 12px 24px;
        }
        
        .result {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .employee-list {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .employee-item {
            padding: 10px;
            background: white;
            margin-bottom: 10px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .config {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ffc107;
        }
        
        .config input {
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab active" onclick="showTab('admin')">üë®‚Äçüíº Admin</button>
            <button class="tab" onclick="showTab('customer')">üë§ Customer Chat</button>
        </div>
        
        <!-- ADMIN PANEL -->
        <div id="admin" class="panel active">
            <div class="config">
                <label>üîß API URL:</label>
                <input type="text" id="apiUrl" value="https://orchestrator-service-v4yckht2dq-uc.a.run.app" placeholder="Your Cloud Run URL">
            </div>
            
            <h2>Add Financial Advisor</h2>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="empName" placeholder="e.g., Sarah">
            </div>
            <div class="form-group">
                <label>Role:</label>
                <input type="text" id="empRole" value="Financial Advisor">
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="empEmail" value="ceo@mlground.com">
            </div>
            <button onclick="addEmployee()">Add Advisor</button>
            <div id="empResult"></div>
            
            <div class="employee-list" id="employeeList">
                <strong>Current Advisors:</strong>
                <div id="employees"></div>
            </div>
            
            <hr style="margin: 30px 0; border: 1px solid #e0e0e0;">
            
            <h2>Add Time Slot</h2>
            <div class="form-group">
                <label>Select Advisor:</label>
                <select id="slotEmployee">
                    <option value="">First add an advisor above</option>
                </select>
            </div>
            <div class="form-group">
                <label>Date:</label>
                <input type="date" id="slotDate">
            </div>
            <div class="form-group">
                <label>Start Time:</label>
                <input type="time" id="slotStart" value="09:00">
            </div>
            <div class="form-group">
                <label>End Time:</label>
                <input type="time" id="slotEnd" value="09:30">
            </div>
            <button onclick="addSlot()">Add Time Slot</button>
            <div id="slotResult"></div>
            
            <hr style="margin: 30px 0; border: 1px solid #e0e0e0;">
            
            <h2>View Appointments</h2>
            <button onclick="viewAppointments()">Refresh Appointments</button>
            <div id="appointments"></div>
        </div>
        
        <!-- CUSTOMER CHAT PANEL -->
        <div id="customer" class="panel">
            <div class="config">
                <label>üîß API URL:</label>
                <input type="text" id="apiUrlChat" value="https://orchestrator-service-v4yckht2dq-uc.a.run.app" placeholder="Your Cloud Run URL">
            </div>
            
            <h2>üí¨ Book a Call with Financial Advisor</h2>
            <div class="chat-container">
                <div class="messages" id="messages">
                    <div class="message bot">
                        üëã Welcome to MLG-Financials! Click "Start" to begin.
                    </div>
                </div>
                <div class="input-group">
                    <input type="text" id="userInput" placeholder="Type your message..." onkeypress="if(event.key==='Enter') sendMessage()">
                    <button onclick="sendMessage()">Send</button>
                    <button onclick="startChat()" style="background: #28a745;">Start</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let userId = 'user_' + Math.random().toString(36).substr(2, 9);
        let employeeData = [];
        
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
            
            if (tab === 'admin') {
                loadEmployees();
            }
        }
        
        function getApiUrl() {
            return document.getElementById('apiUrl').value || document.getElementById('apiUrlChat').value;
        }
        
        async function addEmployee() {
            const name = document.getElementById('empName').value;
            const role = document.getElementById('empRole').value;
            const email = document.getElementById('empEmail').value;
            
            if (!name) {
                showResult('empResult', 'Please enter advisor name', 'error');
                return;
            }
            
            try {
                const res = await fetch(getApiUrl() + '/api/v1/admin/employees', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, role, email })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showResult('empResult', `‚úÖ Added ${name} (ID: ${data.employee.employee_id})`, 'success');
                    document.getElementById('empName').value = '';
                    loadEmployees();
                } else {
                    showResult('empResult', '‚ùå Failed: ' + JSON.stringify(data), 'error');
                }
            } catch (err) {
                showResult('empResult', '‚ùå Error: ' + err.message, 'error');
            }
        }
        
        async function loadEmployees() {
            try {
                const res = await fetch(getApiUrl() + '/api/v1/admin/employees');
                const data = await res.json();
                
                employeeData = data.employees || [];
                
                const empDiv = document.getElementById('employees');
                const select = document.getElementById('slotEmployee');
                
                if (employeeData.length === 0) {
                    empDiv.innerHTML = '<p style="color: #666; padding: 10px;">No advisors yet</p>';
                    select.innerHTML = '<option value="">Add an advisor first</option>';
                    return;
                }
                
                empDiv.innerHTML = employeeData.map(e => `
                    <div class="employee-item">
                        <div>
                            <strong>${e.name}</strong> - ${e.role}
                            <br><small style="color: #666;">ID: ${e.employee_id}</small>
                        </div>
                    </div>
                `).join('');
                
                select.innerHTML = employeeData.map(e => 
                    `<option value="${e.employee_id}">${e.name}</option>`
                ).join('');
                
            } catch (err) {
                console.error('Load employees error:', err);
            }
        }
        
        async function addSlot() {
            const employee_id = document.getElementById('slotEmployee').value;
            const date = document.getElementById('slotDate').value;
            const start_time = document.getElementById('slotStart').value;
            const end_time = document.getElementById('slotEnd').value;
            
            if (!employee_id || !date || !start_time || !end_time) {
                showResult('slotResult', 'Please fill all fields', 'error');
                return;
            }
            
            try {
                const res = await fetch(getApiUrl() + '/api/v1/admin/slots', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ employee_id, date, start_time, end_time })
                });
                
                const data = await res.json();
                
                if (data.success) {
                    showResult('slotResult', `‚úÖ Slot added: ${date} ${start_time}-${end_time}`, 'success');
                } else {
                    showResult('slotResult', '‚ùå Failed: ' + JSON.stringify(data), 'error');
                }
            } catch (err) {
                showResult('slotResult', '‚ùå Error: ' + err.message, 'error');
            }
        }
        
        async function viewAppointments() {
            try {
                const res = await fetch(getApiUrl() + '/api/v1/admin/appointments');
                const data = await res.json();
                
                const div = document.getElementById('appointments');
                const apts = data.appointments || [];
                
                if (apts.length === 0) {
                    div.innerHTML = '<div class="result">No appointments yet</div>';
                    return;
                }
                
                div.innerHTML = '<div class="employee-list">' + 
                    apts.map(a => `
                        <div class="employee-item">
                            <div>
                                <strong>${a.customer_name}</strong> with <strong>${a.employee_name}</strong>
                                <br>üìÖ ${a.date} at ${a.time}
                                <br><small>Status: ${a.status}</small>
                            </div>
                        </div>
                    `).join('') + '</div>';
                
            } catch (err) {
                showResult('appointments', '‚ùå Error: ' + err.message, 'error');
            }
        }
        
        function showResult(id, message, type) {
            const div = document.getElementById(id);
            div.innerHTML = `<div class="result ${type}">${message}</div>`;
            setTimeout(() => div.innerHTML = '', 5000);
        }
        
        // CUSTOMER CHAT
        function startChat() {
            sendMessage('TERMS_ACCEPTED');
        }
        
        async function sendMessage(msg) {
            const input = document.getElementById('userInput');
            const message = msg || input.value.trim();
            
            if (!message) return;
            
            addMessage('user', message);
            input.value = '';
            
            try {
                const res = await fetch(getApiUrl() + '/api/v1/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: userId, message })
                });
                
                const data = await res.json();
                addMessage('bot', data.response);
                
            } catch (err) {
                addMessage('bot', '‚ùå Error: ' + err.message);
            }
        }
        
        function addMessage(type, text) {
            const messagesDiv = document.getElementById('messages');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${type}`;
            msgDiv.textContent = text;
            messagesDiv.appendChild(msgDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Load employees on start
        loadEmployees();
    </script>
</body>
</html>
